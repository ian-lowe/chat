{% extends "template.html" %}
{% block title %}Index{% endblock %}
{% block js %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    <script>
        var socket = io();
        var nickname = "{{ nickname }}"

        socket.on("connect", function () {

            document.querySelectorAll("button")[0].addEventListener("click", function() {
                let channel_name = document.getElementById("new-channel").value;
                if(channel_name == "") {
                    return;
                }
                channel_name = channel_name.toLowerCase();
                document.getElementById("new-channel").value = "";
                socket.emit("create channel", channel_name);
            });

            document.querySelectorAll("button")[1].addEventListener("click", function() {
                let count = 1;
                socket.emit("my event", nickname, count);
            });

            document.querySelectorAll("button")[2].addEventListener("click", function () {
                let count = -1;
                socket.emit("my event", nickname, count);
            });

            document.querySelectorAll("button")[3].addEventListener("click", function () {
                socket.emit("join", "rm1");
            });

            document.querySelectorAll("button")[4].addEventListener("click", function () {
                let message = document.querySelector(".div4 input");
                message.value = "";
                document.querySelector(".div4 input").focus();
            });

            document.querySelector("#general").addEventListener("click", function() {
                document.querySelector(".div4 input").setAttribute("placeholder", "Message " + this.innerText);
                let channels = document.querySelectorAll(".div1 div");
                for(channel of channels) {
                    channel.classList.remove("selected-channel");
                }
                this.classList.add("selected-channel");
                document.querySelector(".div4 input").focus();
            });

            socket.emit("user connected", nickname);
        });

        socket.on("broadcast channel", function(channel_name) {
            const new_div = document.createElement("div");
            new_div.innerText = "#" + channel_name;
            document.querySelector(".div1").append(new_div);
            new_div.addEventListener("click", function() {
                document.querySelector(".div4 input").setAttribute("placeholder", "Message " + this.innerText);
                let channels = document.querySelectorAll(".div1 div");
                for (channel of channels) {
                    channel.classList.remove("selected-channel");
                }
                this.classList.add("selected-channel");
                document.querySelector(".div4 input").focus();
            });
        });

        socket.on("my response", function(nickname, counter) {
            document.querySelectorAll("li")[0].innerText = counter;
            document.querySelectorAll("li")[1].innerText = nickname;
        });

        socket.on("on connection", function(nickname) {
            document.querySelectorAll("li")[2].innerText = nickname + " has connected.";
        });


    </script>
{% endblock %}
{% block body %}
    <div class="parent">
        <div class="div1">
            <h5>Channels</h5>
            <div class="selected-channel" id="general">#general</div>
        </div>
        <div class="div2">
            <input type="text" placeholder="Create Channel.." id="new-channel">
            <button>+</button>
        </div>
        <div class="div3">
            <ul>
                <li></li>
                <li></li>
                <li></li>
            </ul>
            <button>UP</button>
            <button>DOWN</button>
            <button>RM CHANGE</button>
        </div>
        <div class="div4">
            <button><img src="/static/send.svg" alt="send"></button>
            <input type="text" placeholder="Message #general" autofocus>
        </div>
    </div>
{% endblock %}